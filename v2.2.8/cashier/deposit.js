define(["exports","jquery","websockets/binary_websockets","windows/windows","common/rivetsExtra","lodash","moment","cashier/uk_funds_protection","text!cashier/deposit.html","../common/util"],function(a,b,c,d,e,f,g,h,i){"use strict";function j(a){return a&&a.__esModule?a:{"default":a}}function k(a){a.click(function(){u?u.moveToTop():o["default"].cached.authorize().then(function(){l(t["default"])})["catch"](w)})}function l(a){a=n["default"](a).i18n(),u=p["default"].createBlankWindow(a,{title:"Deposit funds",resizable:!0,collapsable:!1,minimizable:!0,maximizable:!0,width:700,height:600,"data-authorized":!0,close:function(){u.trigger("dialogclose"),u.remove(),u=null},open:function(){},destroy:function(){v&&v.unbind(),v=null}}),m(a),u.dialog("open");var b=u.dialog("widget").offset();b.top=110,u.dialog("option","position",{my:b.left,at:b.top}),u.dialog("widget").css({left:b.left+"px",top:b.top+"px"}),u.track({module_id:"deposit",is_unique:!0})}function m(a){var b={route:{value:"standard-methods"},empty_fields:{validate:!1,clear:r["default"].debounce(function(){b.empty_fields.validate=!1},4e3),show:function(){b.empty_fields.validate=!0,b.empty_fields.clear()}},user:{currency:local_storage.get("currency"),email:local_storage.get("authorize").email,cashier_url:"",residence:"",residence_name:""},is_cryptocurrency:isCryptoCurrency(),standard_methods:{iframe_visible:!1},payment_agents:{list:[],current:{}},binary_url:getBinaryUrl("payment-agent.html")};b.route.update=function(a){b.route.value=a},b.standard_methods.iframe_loaded=function(){b.user.cashier_url&&(b.standard_methods.iframe_visible=!0)},b.payment_agents.get_commission_text=function(a){return a.deposit_commission===a.withdrawal_commission?a.deposit_commission+"% "+"commission".i18n():a.deposit_commission+"% "+"deposits".i18n()+" / "+a.withdrawal_commission+"% "+"withdrawals".i18n()},b.payment_agents.onclick=function(a,c){var d=n["default"](c.target).next(),e=b.payment_agents.elem;e&&e.css("max-height","0"),b.payment_agents.current.is_active=!1,b.payment_agents.current===a?b.payment_agents.current={}:(b.payment_agents.current=a,b.payment_agents.elem=d,d.css("max-height",d[0].scrollHeight+"px"),a.is_active=!0)},v=q["default"].bind(a[0],b),o["default"].send({cashier:"deposit"}).then(function(a){b.user.cashier_url=a.cashier})["catch"](function(a){return"ASK_UK_FUNDS_PROTECTION"===a.code?(u.dialog("close"),void s["default"].init_win().then(function(){l(t["default"])})["catch"](function(a){w(a)})):void(b.error_text=a.message)});var c=o["default"].send({get_settings:1}).then(function(a){b.user.residence=a.get_settings.country_code,b.user.residence_name=a.get_settings.country})["catch"](w);c.then(function(){return b.user.residence?o["default"].send({paymentagent_list:b.user.residence,currency:b.user.currency}):{paymentagent_list:{list:[]}}}).then(function(a){var c=a.paymentagent_list.list.map(function(a){return a.commission_text=b.payment_agents.get_commission_text(a),a.supported_banks=a.supported_banks.toLowerCase().split(","),a});b.payment_agents.list=c})["catch"](w)}Object.defineProperty(a,"__esModule",{value:!0}),a.init=k;var n=j(b),o=j(c),p=j(d),q=j(e),r=j(f),s=(j(g),j(h)),t=j(i);require(["text!cashier/deposit.html"]),require(["css!cashier/deposit.css"]);var u=null,v=null,w=function(a){n["default"].growl.error({message:a.message})};a["default"]={init:k}});