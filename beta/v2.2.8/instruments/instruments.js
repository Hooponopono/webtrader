define(["exports","jquery","websockets/binary_websockets","navigation/menu","charts/chartWindow","../common/marketUtils","jquery-growl","common/util"],function(t,e,a,n,r,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSpecificMarketData=t.isMarketDataPresent=t.getMarketData=t.init=void 0;var s=o(e),u=o(a),m=o(n),l=o(r);function o(t){return t&&t.__esModule?t:{default:t}}function d(){u.default.send({active_symbols:"brief"}).then(function(t){local_storage.set("active_symbols",t.active_symbols);var n=[];_(t.active_symbols).groupBy("market").map(function(t){var e=_.head(t),a={name:e.market,display_name:e.market_display_name};return a.submarkets=_(t).groupBy("submarket").map(function(t){var e=_.head(t),a={name:e.submarket,display_name:e.submarket_display_name};return a.instruments=_.map(t,function(t){return n.push(t.symbol),{symbol:t.symbol,display_name:t.display_name}}),a}).value(),a}).value();c=k.map(function(t){return{display_name:t.display_name,name:t.name,submarkets:t.submarkets.map(function(t){return{display_name:t.display_name,instruments:t.instruments.filter(function(t){return-1!==n.indexOf(t.symbol)})}}).filter(function(t){return 0!==t.instruments.length})}}).filter(function(t){return 0!==t.submarkets.length}),c=(0,i.getMarketPosition)(c);var e=(0,s.default)("#nav-menu").find(".instruments");e.find("> ul").remove(),m.default.refreshMenu(e,c,f)})}function f(t,e){l.default.addNewWindow({instrumentCode:t,instrumentName:e,timePeriod:"1d",type:"candlestick"})}var c=[],k=[],p=t.init=function(){return u.default.cached.send({trading_times:(new Date).toISOString().slice(0,10)}).then(function(t){return k=m.default.extractChartableMarkets(t),d(),u.default.events.on("login",d),u.default.events.on("logout",d),k})},y=t.getMarketData=function(){return c},b=t.isMarketDataPresent=function(a,t){var n=!1;t||(t=c);var r=this;return s.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.isMarketDataPresent(a,e.submarkets||e.instruments):s.default.trim(e.display_name)==s.default.trim(a)&&(n=!0),!n}),n},v=t.getSpecificMarketData=function(a,t){var n={};t||(t=c);var r=this;return s.default.each(t,function(t,e){return e.submarkets||e.instruments?n=r.getSpecificMarketData(a,e.submarkets||e.instruments):s.default.trim(e.display_name)==s.default.trim(a)&&(n=e),s.default.isEmptyObject(n)}),n};t.default={init:p,getMarketData:y,isMarketDataPresent:b,getSpecificMarketData:v}});