define(["exports","babel-runtime/regenerator","jquery","../websockets/binary_websockets","lodash","../tc/tc","../common/util"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a){return function(){var b=a.apply(this,arguments);return new Promise(function(a,c){function d(e,f){try{var g=b[e](f),h=g.value}catch(i){return void c(i)}return g.done?void a(h):Promise.resolve(h).then(function(a){d("next",a)},function(a){d("throw",a)})}return d("next")})}}function i(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var j=g(b),k=g(c),l=g(d),m=g(e),n=g(f),o=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),q=function(a){k["default"](".webtrader-dialog").parent().each(function(){var b=1*k["default"](this).css("top").replace("px","");a>=b&&k["default"](this).animate({top:a+"px"},300)})},r=!1,s=function(){function a(){i(this,a),l["default"].events.on("login",this.onLogin.bind(this)),l["default"].events.on("reset_accountstatus",function(){var a=k["default"]("#msg-notification");a.is(":visible")&&a.slideUp(500),r=!1})}return p(a,[{key:"onLogin",value:function(){function a(){return b.apply(this,arguments)}var b=h(j["default"].mark(function c(a){var b,d,e,f,g,h,i,l;return j["default"].wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(b=k["default"]("#msg-notification"),1!==+a.authorize.is_virtual){c.next=6;break}return b.is(":visible")&&b.slideUp(500),r=!1,q(115),c.abrupt("return");case 6:return c.next=8,this.getStatus(a.authorize);case 8:d=c.sent,e=o(d,5),f=e[0],g=e[1],h=e[2],i=e[3],l=e[4],this.tc_accepted=!1,this.financial_assessment_submitted=!0,this.is_mlt=/^malta$/gi.test(a.authorize.landing_company_name),this.is_mf=/^maltainvest$/gi.test(a.authorize.landing_company_name),this.is_cr=/^costarica$/gi.test(a.authorize.landing_company_name),this.has_mt5_account=l.mt5_login_list.length>0,this.is_authenticated=!f.get_account_status.prompt_client_to_authenticate,g&&g.website_status&&h&&h.get_settings&&(this.tc_accepted=g.website_status.terms_conditions_version===h.get_settings.client_tnc_status),("high"===f.get_account_status.risk_classification||this.is_mf)&&(this.financial_assessment_submitted=-1==f.get_account_status.status.indexOf("financial_assessment_not_complete")),this.checkStatus(a.authorize,f.get_account_status.status);case 25:case"end":return c.stop()}},c,this)}));return a}()},{key:"getStatus",value:function(){return Promise.all([l["default"].send({get_account_status:1}),l["default"].send({website_status:1}),l["default"].send({get_settings:1}),l["default"].cached.send({get_financial_assessment:1}),l["default"].send({mt5_login_list:1})])}},{key:"checkStatus",value:function(a,b){var c=k["default"]("#msg-notification"),d=this,e=function(a){{var b=getBinaryUrl(a);window.open(b,"_blank")}},f={excluded_until:{message:"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return 0==local_storage.get("excluded")},callback:function(){return e("contact")}},tc:{message:"Please [_1]accept the updated Terms and Conditions[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return d.tc_accepted},callback:n["default"].init},risk:{message:"Please complete the [_1]financial assessment form[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return d.financial_assessment_submitted},callback:function(){return e("user/settings/assessmentws")}},tax:{message:"Please [_1]complete your account profile[_2] to lift your withdrawal and trading limits.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return!d.is_mf||/crs_tin_information/.test(b)},callback:function(){return e("user/settings/detailsws")}},currency:{message:"Please set the [_1]currency[_2] of your account".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return local_storage.get("currency")},callback:function(){return e("user/set-currency")}},authenticate:{message:"[_1]Authenticate your account[_2] now to take full advantage of all withdrawal options available.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return d.is_authenticated},callback:function(){return e("user/authenticate")}},unwelcome:{message:"Your account is restricted. Kindly [_1]contact customer support[_2] for assistance.".i18n().replace("[_1]",'<a href="#">').replace("[_2]","</a>"),is_valid:function(){return!/(unwelcome|(cashier|withdrawal)_locked)/.test(b)},callback:function(){return e("contact")}}},g=m["default"].find(f,function(a){return!a.is_valid()});g?(c.html(g.message),c.find("a").on("click",g.callback),c.slideDown(500),q(140),r=!0):(c.is(":visible")&&c.slideUp(500),q(115),r=!1)}}]),a}(),t=a.init=new s;a["default"]={init:t,recheckStatus:function(a){return t.onLogin({authorize:a})},is_shown:function(){return r}}});