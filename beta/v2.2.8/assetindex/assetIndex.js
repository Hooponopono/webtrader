define(["exports","jquery","../windows/windows","../websockets/binary_websockets","common/rivetsExtra","../common/marketUtils","jquery-growl","css!./assetIndex.css"],function(a,b,c,d,e,f){"use strict";function g(a){return a&&a.__esModule?a:{"default":a}}function h(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}Object.defineProperty(a,"__esModule",{value:!0}),a.init=void 0;var i=g(b),j=g(c),k=g(d),l=g(e),m=g(f),n=null,o=null,p=null,q=null,r=a.init=function(a){a.click(function(){o?o.moveToTop():(o=j["default"].createBlankWindow(i["default"]("<div/>"),{title:"Asset Index".i18n(),dialogClass:"assetIndex",minWidth:800,minHeight:400}),o.track({module_id:"assetIndex",is_unique:!0,data:null}),o.dialog("open"),require(["text!assetindex/assetIndex.html"],v))})},s={dropdown:{display_markets:null,display_submarkets:null,is_volatility:!1,market_submarkets:null,selected_market:null},table:{asset_data:[],asset_data_extract:[],display_headers:[],display_asset_data:[],search_input:""},search:function(){function a(a){var b=s.table.search_input.toLowerCase();return-1!==a[0].toLowerCase().indexOf(b.toLowerCase())}return function(){s.table.display_asset_data=[],s.table.display_asset_data=s.table.asset_data_extract.filter(a),s.dropdown.is_volatility=t(s.dropdown.selected_market,s.dropdown.display_markets)}()}},t=function(a,b){var c=b[0][2]?b[0][2].innerText:b[0][0].innerText,d=-1!==a.indexOf(c);return d},u=function(){function a(a){function b(a,b){function c(a){var b=[];return a.forEach(function(a){var c=new Array(s.table.display_headers.length+1);a.forEach(function(a){if(Array.isArray(a)){var b=a[0],d=a[1],e=s.table.display_headers.indexOf(b)+1;c[e]=d}else c[0]=a}),b.push(c)}),b}function d(a){for(var b=s.table.display_headers.length,c=function(b){a.forEach(function(a){(!a[b]||Array.isArray(a[b]))&&(a[b]="-")})},d=0;b>=d;d++)c(d);return a}var e=[].concat(h(s.dropdown.market_submarkets[a][b]));s.dropdown.selected_market=a,s.dropdown.is_volatility=t(a,s.dropdown.display_markets);var f=s.table.asset_data.filter(function(a){return e.indexOf(a[1])>-1}).map(function(a){var b=[],c=a[1],d=a[2];return s.table.display_headers=[],b.push(c),d.forEach(function(a){var c=a[1],d=a[2],e=a[3];s.table.display_headers.push(c),b.push([c,d+" - "+e])}),b});f=c(f),f=d(f),s.table.display_asset_data=f,s.table.asset_data_extract=f}function c(a){s.dropdown.display_markets?s.dropdown.display_markets.update_list(Object.keys(a)):(s.dropdown.display_markets=j["default"].makeSelectmenu(i["default"]("<select />").insertAfter(o),{list:Object.keys(a),inx:0,changed:function(c){var d=Object.keys(a[c]);s.dropdown.display_submarkets.update_list(d),b(s.dropdown.display_markets.val(),s.dropdown.display_submarkets.val())},width:"180px"}),s.dropdown.display_markets.selectmenu("widget").addClass("asset-index-selectmenu"))}function d(a){s.dropdown.display_submarkets?s.dropdown.display_submarkets.update_list(Object.keys(a[s.dropdown.display_markets.val()])):(s.dropdown.display_submarkets=j["default"].makeSelectmenu(i["default"]("<select />").insertAfter(o),{list:Object.keys(a[s.dropdown.display_markets.val()]),inx:0,changed:function(){b(s.dropdown.display_markets.val(),s.dropdown.display_submarkets.val())},width:"200px"}),s.dropdown.display_submarkets.selectmenu("widget").addClass("asset-index-selectmenu"))}var e=Object.assign(a[0].active_symbols),f=[].concat(h(a[1].asset_index));s.dropdown.market_submarkets=m["default"](e),s.table.asset_data=f,p=o.parent().find(".ui-dialog-title").addClass("with-content"),q=o.parent().find(".ui-dialog-titlebar-buttonpane"),c(s.dropdown.market_submarkets),d(s.dropdown.market_submarkets),b(s.dropdown.display_markets.val(),s.dropdown.display_submarkets.val())}function b(){var a=i["default"]("#"+n.attr("id")+"_processing").show(),b={active_symbols:"brief"},c={asset_index:1};return Promise.all([k["default"].cached.send(b),k["default"].cached.send(c)]).then(function(b){return a.hide(),Promise.resolve(b)})["catch"](function(b){return a.hide(),Promise.reject(b)})}b().then(function(b){a(b)})["catch"](function(a){i["default"].growl.error({message:a.message})})},v=function(a){a=i["default"](a).i18n(),n=a.filter("table"),a.appendTo(o),l["default"].bind(a[0],s),u(),require(["websockets/binary_websockets"],function(a){a.events.on("login",u),a.events.on("logout",u)})};a["default"]={init:r}});